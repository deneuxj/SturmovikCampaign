#r "nuget: FSharp.Charting"
#r "nuget: SturmovikMission.DataProvider"
#r "System.Windows.Forms.DataVisualization"

open FSharp.Charting
open SturmovikMission.DataProvider.Parsing

let (|AsNum|_|) =
    function
    | ReFloat(x, s) -> Some(x, s)
    | ReInt(n, s) -> Some(float n, s)
    | _ -> None

let (|AsVector2|_|) s =
    match s with
    | ReLit "<" (AsNum(x, ReLit "," (AsNum(y, ReLit ">" s)))) ->
        Some((x, y), s)
    | _ ->
        None

let (|AsList|_|) inner s =
    match s with
    | ReLit "[" s ->
        let rec work res s =
            match inner s with
            | Some(v, s) ->
                match s with
                | ReLit "]" s ->
                    Some(v :: res, s)
                | ReLit ";" s ->
                    work (v :: res) s
                | _ ->
                    None
            | _ -> None
        match s with
        | ReLit "]" s ->
            Some([], s)
        | _ ->
            work [] s
            |> Option.map (fun (vs, s) -> List.rev vs, s)
    | _ ->
        None

let (|AsVectors|_|) =
    let inner = function AsVector2(v, s) -> Some(v, s) | _ -> None
    function
    | AsList inner (vs, s) -> Some (vs, s)
    | _ -> None

let (|AsPolygon|_|) s =
    match s with
    | AsVectors(vs, s) ->
        match vs with
        | [] -> None
        | _ -> Some(List.last vs :: vs, s)
    | _ ->
        None

let (|AsPolygons|_|) =
    let inner = function AsPolygon(poly, s) -> Some(poly, s) | _ -> None
    function
    | AsList inner (polygons, s) -> Some(polygons, s)
    | _ -> None

let (|AsTestData|_|) s =
    match s with
    | AsPolygons(polygons, ReLit "," (ReInt(seed, ReLit "," (AsPolygon(subShape, s))))) ->
        Some((polygons, seed, subShape), s)
    | _ ->
        None

let (|AsDebugData|_|) s =
    match s with
    | ReLit "("
        (AsPolygons(
            candidates,
            ReLit ","
                (AsPolygons(
                    qt,
                    ReLit ","
                        (AsPolygons(fa1, (ReLit "," (AsPolygons(fa2, ReLit ")" _))))))))) ->
        Some((candidates, qt, fa1, fa2), s)
    | _ ->
        None

let s =
    Stream.FromString """
[[<67.25, 8.370001>; <74.24, 14.220001>; <64.07, 21.81>; <52.55, 18.93>;
<55.73, 10.380001>];
      [<76.57, 13.24>; <68.23, 31.84>; <56.71, 33.85>; <53.530003, 19.09>;
<65.05, 15.25>]], 776257853,
     [<32.24, 58.84>; <29.630001, 81.04>; <11.87, 85.3>; <9.5, 64.659996>;
      <19.670002, 59.32>]
"""

let c =
    Stream.FromString """
([[<80.84026, 13.478905>; <79.37579, 17.014439>; <75.84026, 18.478905>;
<72.30473, 17.014439>; <70.84026, 13.478905>; <72.30473, 9.943371>;
<75.84026, 8.478905>; <79.3758, 9.943372>; <80.84026, 13.478906>];
      [<78.22641, 12.622688>; <76.76195, 16.158222>; <73.22641, 17.622688>;
<69.69087, 16.158222>; <68.22641, 12.622688>; <69.69088, 9.087154>;
<73.22641, 7.6226883>; <76.76195, 9.087155>; <78.22641, 12.622689>];
      [<78.7004, 13.287321>; <77.23593, 16.822855>; <73.7004, 18.287321>;
<70.16487, 16.822855>; <68.7004, 13.287321>; <70.16487, 9.751787>;
<73.7004, 8.287321>; <77.23594, 9.751788>; <78.7004, 13.287322>];
      [<74.81896, 9.967585>; <73.35449, 13.5031185>; <69.81896, 14.967585>;
<66.28343, 13.5031185>; <64.81896, 9.967585>; <66.28343, 6.43205>;
<69.81896, 4.9675846>; <73.3545, 6.4320517>; <74.81896, 9.967586>];
      [<77.77857, 13.041427>; <76.3141, 16.576962>; <72.77857, 18.041428>;
<69.24304, 16.576962>; <67.77857, 13.041427>; <69.24304, 9.505892>;
<72.77857, 8.041427>; <76.31411, 9.505894>; <77.77857, 13.041428>];
      [<78.82012, 12.888844>; <77.35565, 16.424377>; <73.82012, 17.888844>;
<70.28459, 16.424377>; <68.82012, 12.888844>; <70.28459, 9.35331>;
<73.82012, 7.8888435>; <77.35566, 9.353311>; <78.82012, 12.8888445>];
      [<80.82975, 13.737028>; <79.36528, 17.272562>; <75.82975, 18.737028>;
<72.29422, 17.272562>; <70.82975, 13.737028>; <72.29422, 10.201494>;
<75.82975, 8.737028>; <79.36529, 10.201495>; <80.82975, 13.737029>];
      [<78.116005, 15.662577>; <76.651535, 19.19811>; <73.116005, 20.662577>;
<69.580475, 19.19811>; <68.116005, 15.662577>; <69.580475, 12.127043>;
<73.116005, 10.662577>; <76.65154, 12.127044>; <78.116005, 15.662578>];
      [<77.781235, 12.612204>; <76.31677, 16.147738>; <72.781235, 17.612204>;
<69.2457, 16.147738>; <67.781235, 12.612204>; <69.245705, 9.07667>;
<72.781235, 7.6122036>; <76.31677, 9.076671>; <77.781235, 12.612205>];
      [<78.38735, 14.495228>; <76.92288, 18.030762>; <73.38735, 19.495228>;
<69.85182, 18.030762>; <68.38735, 14.495228>; <69.85182, 10.959694>;
<73.38735, 9.495228>; <76.92289, 10.959695>; <78.38735, 14.495229>]],
     [[<52.55, 8.370001>;<58.555, 8.370001>;<58.555, 14.740001>;<52.55, 14.740001>];[<52.55, 14.740001>;<55.552498, 14.740001>;<55.552498, 17.925001>;<52.55, 17.925001>];[<52.55, 17.925001>;<53.30062, 17.925001>;<53.30062, 18.721252>;<52.55, 18.721252>];[<52.55, 18.721252>;<53.30062, 18.721252>;<53.30062, 19.517502>;<52.55, 19.517502>];[<53.30062, 17.925001>;<54.051247, 17.925001>;<54.051247, 18.721252>;<53.30062, 18.721252>];[<53.30062, 18.721252>;<54.051247, 18.721252>;<54.051247, 19.517502>;<53.30062, 19.517502>];[<52.55, 19.517502>;<54.051247, 19.517502>;<54.051247, 21.11>;<52.55, 21.11>];[<54.051247, 17.925001>;<54.801872, 17.925001>;<54.801872, 18.721252>;<54.051247, 18.721252>];[<54.051247, 18.721252>;<54.801872, 18.721252>;<54.801872, 19.517502>;<54.051247, 19.517502>];[<54.801872, 17.925001>;<55.552498, 17.925001>;<55.552498, 18.721252>;<54.801872, 18.721252>];
    [<54.801872, 18.721252>;<55.552498, 18.721252>;<55.552498, 19.517502>;<54.801872, 19.517502>];[<54.051247, 19.517502>;<54.801872, 19.517502>;<54.801872, 20.313751>;<54.051247, 20.313751>];[<54.051247, 20.313751>;<54.801872, 20.313751>;<54.801872, 21.11>;<54.051247, 21.11>];[<54.801872, 19.517502>;<55.552498, 19.517502>;<55.552498, 20.313751>;<54.801872, 20.313751>];[<54.801872, 20.313751>;<55.552498, 20.313751>;<55.552498, 21.11>;<54.801872, 21.11>];[<55.552498, 14.740001>;<57.05375, 14.740001>;<57.05375, 16.3325>;<55.552498, 16.3325>];[<55.552498, 16.3325>;<56.303123, 16.3325>;<56.303123, 17.12875>;<55.552498, 17.12875>];[<55.552498, 17.12875>;<56.303123, 17.12875>;<56.303123, 17.925001>;<55.552498, 17.925001>];[<56.303123, 16.3325>;<57.05375, 16.3325>;<57.05375, 17.12875>;<56.303123, 17.12875>];[<56.303123, 17.12875>;<57.05375, 17.12875>;<57.05375, 17.925001>;<56.303123, 17.925001>];
    [<57.05375, 14.740001>;<58.555, 14.740001>;<58.555, 16.3325>;<57.05375, 16.3325>];[<57.05375, 16.3325>;<57.804375, 16.3325>;<57.804375, 17.12875>;<57.05375, 17.12875>];[<57.05375, 17.12875>;<57.804375, 17.12875>;<57.804375, 17.925001>;<57.05375, 17.925001>];[<57.804375, 16.3325>;<58.555, 16.3325>;<58.555, 17.12875>;<57.804375, 17.12875>];[<57.804375, 17.12875>;<58.555, 17.12875>;<58.555, 17.925001>;<57.804375, 17.925001>];[<55.552498, 17.925001>;<56.303123, 17.925001>;<56.303123, 18.721252>;<55.552498, 18.721252>];[<55.552498, 18.721252>;<56.303123, 18.721252>;<56.303123, 19.517502>;<55.552498, 19.517502>];[<56.303123, 17.925001>;<57.05375, 17.925001>;<57.05375, 18.721252>;<56.303123, 18.721252>];[<56.303123, 18.721252>;<57.05375, 18.721252>;<57.05375, 19.517502>;<56.303123, 19.517502>];[<55.552498, 19.517502>;<56.303123, 19.517502>;<56.303123, 20.313751>;<55.552498, 20.313751>];
    [<55.552498, 20.313751>;<56.303123, 20.313751>;<56.303123, 21.11>;<55.552498, 21.11>];[<56.303123, 19.517502>;<57.05375, 19.517502>;<57.05375, 20.313751>;<56.303123, 20.313751>];[<56.303123, 20.313751>;<57.05375, 20.313751>;<57.05375, 21.11>;<56.303123, 21.11>];[<57.05375, 17.925001>;<57.804375, 17.925001>;<57.804375, 18.721252>;<57.05375, 18.721252>];[<57.05375, 18.721252>;<57.804375, 18.721252>;<57.804375, 19.517502>;<57.05375, 19.517502>];[<57.804375, 17.925001>;<58.555, 17.925001>;<58.555, 18.721252>;<57.804375, 18.721252>];[<57.804375, 18.721252>;<58.555, 18.721252>;<58.555, 19.517502>;<57.804375, 19.517502>];[<57.05375, 19.517502>;<57.804375, 19.517502>;<57.804375, 20.313751>;<57.05375, 20.313751>];[<57.05375, 20.313751>;<57.804375, 20.313751>;<57.804375, 21.11>;<57.05375, 21.11>];[<57.804375, 19.517502>;<58.555, 19.517502>;<58.555, 20.313751>;<57.804375, 20.313751>];
    [<57.804375, 20.313751>;<58.555, 20.313751>;<58.555, 21.11>;<57.804375, 21.11>];[<58.555, 8.370001>;<64.56, 8.370001>;<64.56, 14.740001>;<58.555, 14.740001>];[<58.555, 14.740001>;<60.05625, 14.740001>;<60.05625, 16.3325>;<58.555, 16.3325>];[<58.555, 16.3325>;<59.305626, 16.3325>;<59.305626, 17.12875>;<58.555, 17.12875>];[<58.555, 17.12875>;<59.305626, 17.12875>;<59.305626, 17.925001>;<58.555, 17.925001>];[<59.305626, 16.3325>;<60.05625, 16.3325>;<60.05625, 17.12875>;<59.305626, 17.12875>];[<59.305626, 17.12875>;<60.05625, 17.12875>;<60.05625, 17.925001>;<59.305626, 17.925001>];[<60.05625, 14.740001>;<61.5575, 14.740001>;<61.5575, 16.3325>;<60.05625, 16.3325>];[<60.05625, 16.3325>;<60.806877, 16.3325>;<60.806877, 17.12875>;<60.05625, 17.12875>];[<60.05625, 17.12875>;<60.806877, 17.12875>;<60.806877, 17.925001>;<60.05625, 17.925001>];
    [<60.806877, 16.3325>;<61.5575, 16.3325>;<61.5575, 17.12875>;<60.806877, 17.12875>];[<60.806877, 17.12875>;<61.5575, 17.12875>;<61.5575, 17.925001>;<60.806877, 17.925001>];[<58.555, 17.925001>;<59.305626, 17.925001>;<59.305626, 18.721252>;<58.555, 18.721252>];[<58.555, 18.721252>;<59.305626, 18.721252>;<59.305626, 19.517502>;<58.555, 19.517502>];[<59.305626, 17.925001>;<60.05625, 17.925001>;<60.05625, 18.721252>;<59.305626, 18.721252>];[<59.305626, 18.721252>;<60.05625, 18.721252>;<60.05625, 19.517502>;<59.305626, 19.517502>];[<58.555, 19.517502>;<59.305626, 19.517502>;<59.305626, 20.313751>;<58.555, 20.313751>];[<58.555, 20.313751>;<59.305626, 20.313751>;<59.305626, 21.11>;<58.555, 21.11>];[<59.305626, 19.517502>;<60.05625, 19.517502>;<60.05625, 20.313751>;<59.305626, 20.313751>];[<59.305626, 20.313751>;<60.05625, 20.313751>;<60.05625, 21.11>;<59.305626, 21.11>];
    [<60.05625, 17.925001>;<60.806877, 17.925001>;<60.806877, 18.721252>;<60.05625, 18.721252>];[<60.05625, 18.721252>;<60.806877, 18.721252>;<60.806877, 19.517502>;<60.05625, 19.517502>];[<60.806877, 17.925001>;<61.5575, 17.925001>;<61.5575, 18.721252>;<60.806877, 18.721252>];[<60.806877, 18.721252>;<61.5575, 18.721252>;<61.5575, 19.517502>;<60.806877, 19.517502>];[<60.05625, 19.517502>;<60.806877, 19.517502>;<60.806877, 20.313751>;<60.05625, 20.313751>];[<60.05625, 20.313751>;<60.806877, 20.313751>;<60.806877, 21.11>;<60.05625, 21.11>];[<60.806877, 19.517502>;<61.5575, 19.517502>;<61.5575, 20.313751>;<60.806877, 20.313751>];[<60.806877, 20.313751>;<61.5575, 20.313751>;<61.5575, 21.11>;<60.806877, 21.11>];[<61.5575, 14.740001>;<62.30812, 14.740001>;<62.30812, 15.536251>;<61.5575, 15.536251>];[<61.5575, 15.536251>;<62.30812, 15.536251>;<62.30812, 16.3325>;<61.5575, 16.3325>];
    [<62.30812, 14.740001>;<63.058746, 14.740001>;<63.058746, 15.536251>;<62.30812, 15.536251>];[<62.30812, 15.536251>;<63.058746, 15.536251>;<63.058746, 16.3325>;<62.30812, 16.3325>];[<61.5575, 16.3325>;<62.30812, 16.3325>;<62.30812, 17.12875>;<61.5575, 17.12875>];[<61.5575, 17.12875>;<62.30812, 17.12875>;<62.30812, 17.925001>;<61.5575, 17.925001>];[<62.30812, 16.3325>;<63.058746, 16.3325>;<63.058746, 17.12875>;<62.30812, 17.12875>];[<62.30812, 17.12875>;<63.058746, 17.12875>;<63.058746, 17.925001>;<62.30812, 17.925001>];[<63.058746, 14.740001>;<63.809372, 14.740001>;<63.809372, 15.536251>;<63.058746, 15.536251>];[<63.058746, 15.536251>;<63.809372, 15.536251>;<63.809372, 16.3325>;<63.058746, 16.3325>];[<63.809372, 14.740001>;<64.56, 14.740001>;<64.56, 15.536251>;<63.809372, 15.536251>];[<63.809372, 15.536251>;<64.56, 15.536251>;<64.56, 16.3325>;<63.809372, 16.3325>];
    [<63.058746, 16.3325>;<63.809372, 16.3325>;<63.809372, 17.12875>;<63.058746, 17.12875>];[<63.058746, 17.12875>;<63.809372, 17.12875>;<63.809372, 17.925001>;<63.058746, 17.925001>];[<63.809372, 16.3325>;<64.56, 16.3325>;<64.56, 17.12875>;<63.809372, 17.12875>];[<63.809372, 17.12875>;<64.56, 17.12875>;<64.56, 17.925001>;<63.809372, 17.925001>];[<61.5575, 17.925001>;<62.30812, 17.925001>;<62.30812, 18.721252>;<61.5575, 18.721252>];[<61.5575, 18.721252>;<62.30812, 18.721252>;<62.30812, 19.517502>;<61.5575, 19.517502>];[<62.30812, 17.925001>;<63.058746, 17.925001>;<63.058746, 18.721252>;<62.30812, 18.721252>];[<62.30812, 18.721252>;<63.058746, 18.721252>;<63.058746, 19.517502>;<62.30812, 19.517502>];[<61.5575, 19.517502>;<62.30812, 19.517502>;<62.30812, 20.313751>;<61.5575, 20.313751>];[<61.5575, 20.313751>;<62.30812, 20.313751>;<62.30812, 21.11>;<61.5575, 21.11>];
    [<62.30812, 19.517502>;<63.058746, 19.517502>;<63.058746, 20.313751>;<62.30812, 20.313751>];[<62.30812, 20.313751>;<63.058746, 20.313751>;<63.058746, 21.11>;<62.30812, 21.11>];[<63.058746, 17.925001>;<63.809372, 17.925001>;<63.809372, 18.721252>;<63.058746, 18.721252>];[<63.058746, 18.721252>;<63.809372, 18.721252>;<63.809372, 19.517502>;<63.058746, 19.517502>];[<63.809372, 17.925001>;<64.56, 17.925001>;<64.56, 18.721252>;<63.809372, 18.721252>];[<63.809372, 18.721252>;<64.56, 18.721252>;<64.56, 19.517502>;<63.809372, 19.517502>];[<63.058746, 19.517502>;<63.809372, 19.517502>;<63.809372, 20.313751>;<63.058746, 20.313751>];[<63.058746, 20.313751>;<63.809372, 20.313751>;<63.809372, 21.11>;<63.058746, 21.11>];[<63.809372, 19.517502>;<64.56, 19.517502>;<64.56, 20.313751>;<63.809372, 20.313751>];[<63.809372, 20.313751>;<64.56, 20.313751>;<64.56, 21.11>;<63.809372, 21.11>];
    [<52.55, 21.11>;<58.555, 21.11>;<58.555, 27.48>;<52.55, 27.48>];[<52.55, 27.48>;<58.555, 27.48>;<58.555, 33.85>;<52.55, 33.85>];[<58.555, 21.11>;<60.05625, 21.11>;<60.05625, 22.7025>;<58.555, 22.7025>];[<58.555, 22.7025>;<60.05625, 22.7025>;<60.05625, 24.295>;<58.555, 24.295>];[<60.05625, 21.11>;<60.806877, 21.11>;<60.806877, 21.90625>;<60.05625, 21.90625>];[<60.05625, 21.90625>;<60.806877, 21.90625>;<60.806877, 22.7025>;<60.05625, 22.7025>];[<60.806877, 21.11>;<61.5575, 21.11>;<61.5575, 21.90625>;<60.806877, 21.90625>];[<60.806877, 21.90625>;<61.5575, 21.90625>;<61.5575, 22.7025>;<60.806877, 22.7025>];[<60.05625, 22.7025>;<61.5575, 22.7025>;<61.5575, 24.295>;<60.05625, 24.295>];[<58.555, 24.295>;<61.5575, 24.295>;<61.5575, 27.48>;<58.555, 27.48>];
    [<61.5575, 21.11>;<62.30812, 21.11>;<62.30812, 21.90625>;<61.5575, 21.90625>];[<61.5575, 21.90625>;<62.30812, 21.90625>;<62.30812, 22.7025>;<61.5575, 22.7025>];[<62.30812, 21.11>;<63.058746, 21.11>;<63.058746, 21.90625>;<62.30812, 21.90625>];[<62.30812, 21.90625>;<63.058746, 21.90625>;<63.058746, 22.7025>;<62.30812, 22.7025>];[<61.5575, 22.7025>;<63.058746, 22.7025>;<63.058746, 24.295>;<61.5575, 24.295>];[<63.058746, 21.11>;<63.809372, 21.11>;<63.809372, 21.90625>;<63.058746, 21.90625>];[<63.058746, 21.90625>;<63.809372, 21.90625>;<63.809372, 22.7025>;<63.058746, 22.7025>];[<63.809372, 21.11>;<64.56, 21.11>;<64.56, 21.90625>;<63.809372, 21.90625>];[<63.809372, 21.90625>;<64.56, 21.90625>;<64.56, 22.7025>;<63.809372, 22.7025>];[<63.058746, 22.7025>;<64.56, 22.7025>;<64.56, 24.295>;<63.058746, 24.295>];
    [<61.5575, 24.295>;<64.56, 24.295>;<64.56, 27.48>;<61.5575, 27.48>];[<58.555, 27.48>;<64.56, 27.48>;<64.56, 33.85>;<58.555, 33.85>];[<64.56, 8.370001>;<67.5625, 8.370001>;<67.5625, 11.555>;<64.56, 11.555>];[<64.56, 11.555>;<67.5625, 11.555>;<67.5625, 14.740001>;<64.56, 14.740001>];[<67.5625, 8.370001>;<70.565, 8.370001>;<70.565, 11.555>;<67.5625, 11.555>];[<67.5625, 11.555>;<69.06375, 11.555>;<69.06375, 13.147501>;<67.5625, 13.147501>];[<67.5625, 13.147501>;<68.313126, 13.147501>;<68.313126, 13.94375>;<67.5625, 13.94375>];[<67.5625, 13.94375>;<68.313126, 13.94375>;<68.313126, 14.740001>;<67.5625, 14.740001>];[<68.313126, 13.147501>;<69.06375, 13.147501>;<69.06375, 13.94375>;<68.313126, 13.94375>];[<68.313126, 13.94375>;<69.06375, 13.94375>;<69.06375, 14.740001>;<68.313126, 14.740001>];
    [<69.06375, 11.555>;<70.565, 11.555>;<70.565, 13.147501>;<69.06375, 13.147501>];[<69.06375, 13.147501>;<69.81438, 13.147501>;<69.81438, 13.94375>;<69.06375, 13.94375>];[<69.06375, 13.94375>;<69.81438, 13.94375>;<69.81438, 14.740001>;<69.06375, 14.740001>];[<69.81438, 13.147501>;<70.565, 13.147501>;<70.565, 13.94375>;<69.81438, 13.94375>];[<69.81438, 13.94375>;<70.565, 13.94375>;<70.565, 14.740001>;<69.81438, 14.740001>];[<64.56, 14.740001>;<65.31062, 14.740001>;<65.31062, 15.536251>;<64.56, 15.536251>];[<64.56, 15.536251>;<65.31062, 15.536251>;<65.31062, 16.3325>;<64.56, 16.3325>];[<65.31062, 14.740001>;<66.06125, 14.740001>;<66.06125, 15.536251>;<65.31062, 15.536251>];[<65.31062, 15.536251>;<66.06125, 15.536251>;<66.06125, 16.3325>;<65.31062, 16.3325>];[<64.56, 16.3325>;<65.31062, 16.3325>;<65.31062, 17.12875>;<64.56, 17.12875>];
    [<64.56, 17.12875>;<65.31062, 17.12875>;<65.31062, 17.925001>;<64.56, 17.925001>];[<65.31062, 16.3325>;<66.06125, 16.3325>;<66.06125, 17.12875>;<65.31062, 17.12875>];[<65.31062, 17.12875>;<66.06125, 17.12875>;<66.06125, 17.925001>;<65.31062, 17.925001>];[<66.06125, 14.740001>;<66.811874, 14.740001>;<66.811874, 15.536251>;<66.06125, 15.536251>];[<66.06125, 15.536251>;<66.811874, 15.536251>;<66.811874, 16.3325>;<66.06125, 16.3325>];[<66.811874, 14.740001>;<67.5625, 14.740001>;<67.5625, 15.536251>;<66.811874, 15.536251>];[<66.811874, 15.536251>;<67.5625, 15.536251>;<67.5625, 16.3325>;<66.811874, 16.3325>];[<66.06125, 16.3325>;<66.811874, 16.3325>;<66.811874, 17.12875>;<66.06125, 17.12875>];[<66.06125, 17.12875>;<66.811874, 17.12875>;<66.811874, 17.925001>;<66.06125, 17.925001>];[<66.811874, 16.3325>;<67.5625, 16.3325>;<67.5625, 17.12875>;<66.811874, 17.12875>];
    [<66.811874, 17.12875>;<67.5625, 17.12875>;<67.5625, 17.925001>;<66.811874, 17.925001>];[<64.56, 17.925001>;<65.31062, 17.925001>;<65.31062, 18.721252>;<64.56, 18.721252>];[<64.56, 18.721252>;<65.31062, 18.721252>;<65.31062, 19.517502>;<64.56, 19.517502>];[<65.31062, 17.925001>;<66.06125, 17.925001>;<66.06125, 18.721252>;<65.31062, 18.721252>];[<65.31062, 18.721252>;<66.06125, 18.721252>;<66.06125, 19.517502>;<65.31062, 19.517502>];[<64.56, 19.517502>;<65.31062, 19.517502>;<65.31062, 20.313751>;<64.56, 20.313751>];[<64.56, 20.313751>;<65.31062, 20.313751>;<65.31062, 21.11>;<64.56, 21.11>];[<65.31062, 19.517502>;<66.06125, 19.517502>;<66.06125, 20.313751>;<65.31062, 20.313751>];[<65.31062, 20.313751>;<66.06125, 20.313751>;<66.06125, 21.11>;<65.31062, 21.11>];[<66.06125, 17.925001>;<66.811874, 17.925001>;<66.811874, 18.721252>;<66.06125, 18.721252>];
    [<66.06125, 18.721252>;<66.811874, 18.721252>;<66.811874, 19.517502>;<66.06125, 19.517502>];[<66.811874, 17.925001>;<67.5625, 17.925001>;<67.5625, 18.721252>;<66.811874, 18.721252>];[<66.811874, 18.721252>;<67.5625, 18.721252>;<67.5625, 19.517502>;<66.811874, 19.517502>];[<66.06125, 19.517502>;<66.811874, 19.517502>;<66.811874, 20.313751>;<66.06125, 20.313751>];[<66.06125, 20.313751>;<66.811874, 20.313751>;<66.811874, 21.11>;<66.06125, 21.11>];[<66.811874, 19.517502>;<67.5625, 19.517502>;<67.5625, 20.313751>;<66.811874, 20.313751>];[<66.811874, 20.313751>;<67.5625, 20.313751>;<67.5625, 21.11>;<66.811874, 21.11>];[<67.5625, 14.740001>;<68.313126, 14.740001>;<68.313126, 15.536251>;<67.5625, 15.536251>];[<67.5625, 15.536251>;<68.313126, 15.536251>;<68.313126, 16.3325>;<67.5625, 16.3325>];[<68.313126, 14.740001>;<69.06375, 14.740001>;<69.06375, 15.536251>;<68.313126, 15.536251>];
    [<68.313126, 15.536251>;<69.06375, 15.536251>;<69.06375, 16.3325>;<68.313126, 16.3325>];[<67.5625, 16.3325>;<68.313126, 16.3325>;<68.313126, 17.12875>;<67.5625, 17.12875>];[<67.5625, 17.12875>;<68.313126, 17.12875>;<68.313126, 17.925001>;<67.5625, 17.925001>];[<68.313126, 16.3325>;<69.06375, 16.3325>;<69.06375, 17.12875>;<68.313126, 17.12875>];[<68.313126, 17.12875>;<69.06375, 17.12875>;<69.06375, 17.925001>;<68.313126, 17.925001>];[<69.06375, 14.740001>;<69.81438, 14.740001>;<69.81438, 15.536251>;<69.06375, 15.536251>];[<69.06375, 15.536251>;<69.81438, 15.536251>;<69.81438, 16.3325>;<69.06375, 16.3325>];[<69.81438, 14.740001>;<70.565, 14.740001>;<70.565, 15.536251>;<69.81438, 15.536251>];[<69.81438, 15.536251>;<70.565, 15.536251>;<70.565, 16.3325>;<69.81438, 16.3325>];[<69.06375, 16.3325>;<69.81438, 16.3325>;<69.81438, 17.12875>;<69.06375, 17.12875>];
    [<69.06375, 17.12875>;<69.81438, 17.12875>;<69.81438, 17.925001>;<69.06375, 17.925001>];[<69.81438, 16.3325>;<70.565, 16.3325>;<70.565, 17.12875>;<69.81438, 17.12875>];[<69.81438, 17.12875>;<70.565, 17.12875>;<70.565, 17.925001>;<69.81438, 17.925001>];[<67.5625, 17.925001>;<68.313126, 17.925001>;<68.313126, 18.721252>;<67.5625, 18.721252>];[<67.5625, 18.721252>;<68.313126, 18.721252>;<68.313126, 19.517502>;<67.5625, 19.517502>];[<68.313126, 17.925001>;<69.06375, 17.925001>;<69.06375, 18.721252>;<68.313126, 18.721252>];[<68.313126, 18.721252>;<69.06375, 18.721252>;<69.06375, 19.517502>;<68.313126, 19.517502>];[<67.5625, 19.517502>;<69.06375, 19.517502>;<69.06375, 21.11>;<67.5625, 21.11>];[<69.06375, 17.925001>;<69.81438, 17.925001>;<69.81438, 18.721252>;<69.06375, 18.721252>];[<69.06375, 18.721252>;<69.81438, 18.721252>;<69.81438, 19.517502>;<69.06375, 19.517502>];
    [<69.81438, 17.925001>;<70.565, 17.925001>;<70.565, 18.721252>;<69.81438, 18.721252>];[<69.81438, 18.721252>;<70.565, 18.721252>;<70.565, 19.517502>;<69.81438, 19.517502>];[<69.06375, 19.517502>;<70.565, 19.517502>;<70.565, 21.11>;<69.06375, 21.11>];[<70.565, 8.370001>;<73.567505, 8.370001>;<73.567505, 11.555>;<70.565, 11.555>];[<70.565, 11.555>;<72.06625, 11.555>;<72.06625, 13.147501>;<70.565, 13.147501>];[<70.565, 13.147501>;<71.31563, 13.147501>;<71.31563, 13.94375>;<70.565, 13.94375>];[<70.565, 13.94375>;<71.31563, 13.94375>;<71.31563, 14.740001>;<70.565, 14.740001>];[<71.31563, 13.147501>;<72.06625, 13.147501>;<72.06625, 13.94375>;<71.31563, 13.94375>];[<71.31563, 13.94375>;<72.06625, 13.94375>;<72.06625, 14.740001>;<71.31563, 14.740001>];[<72.06625, 11.555>;<73.567505, 11.555>;<73.567505, 13.147501>;<72.06625, 13.147501>];
    [<72.06625, 13.147501>;<72.81688, 13.147501>;<72.81688, 13.94375>;<72.06625, 13.94375>];[<72.06625, 13.94375>;<72.81688, 13.94375>;<72.81688, 14.740001>;<72.06625, 14.740001>];[<72.81688, 13.147501>;<73.567505, 13.147501>;<73.567505, 13.94375>;<72.81688, 13.94375>];[<72.81688, 13.94375>;<73.567505, 13.94375>;<73.567505, 14.740001>;<72.81688, 14.740001>];[<73.567505, 8.370001>;<76.57, 8.370001>;<76.57, 11.555>;<73.567505, 11.555>];[<73.567505, 11.555>;<75.068756, 11.555>;<75.068756, 13.147501>;<73.567505, 13.147501>];[<73.567505, 13.147501>;<74.31813, 13.147501>;<74.31813, 13.94375>;<73.567505, 13.94375>];[<73.567505, 13.94375>;<74.31813, 13.94375>;<74.31813, 14.740001>;<73.567505, 14.740001>];[<74.31813, 13.147501>;<75.068756, 13.147501>;<75.068756, 13.94375>;<74.31813, 13.94375>];[<74.31813, 13.94375>;<75.068756, 13.94375>;<75.068756, 14.740001>;<74.31813, 14.740001>];
    [<75.068756, 11.555>;<76.57, 11.555>;<76.57, 13.147501>;<75.068756, 13.147501>];[<75.068756, 13.147501>;<76.57, 13.147501>;<76.57, 14.740001>;<75.068756, 14.740001>];[<70.565, 14.740001>;<71.31563, 14.740001>;<71.31563, 15.536251>;<70.565, 15.536251>];[<70.565, 15.536251>;<71.31563, 15.536251>;<71.31563, 16.3325>;<70.565, 16.3325>];[<71.31563, 14.740001>;<72.06625, 14.740001>;<72.06625, 15.536251>;<71.31563, 15.536251>];[<71.31563, 15.536251>;<72.06625, 15.536251>;<72.06625, 16.3325>;<71.31563, 16.3325>];[<70.565, 16.3325>;<71.31563, 16.3325>;<71.31563, 17.12875>;<70.565, 17.12875>];[<70.565, 17.12875>;<71.31563, 17.12875>;<71.31563, 17.925001>;<70.565, 17.925001>];[<71.31563, 16.3325>;<72.06625, 16.3325>;<72.06625, 17.12875>;<71.31563, 17.12875>];[<71.31563, 17.12875>;<72.06625, 17.12875>;<72.06625, 17.925001>;<71.31563, 17.925001>];
    [<72.06625, 14.740001>;<72.81688, 14.740001>;<72.81688, 15.536251>;<72.06625, 15.536251>];[<72.06625, 15.536251>;<72.81688, 15.536251>;<72.81688, 16.3325>;<72.06625, 16.3325>];[<72.81688, 14.740001>;<73.567505, 14.740001>;<73.567505, 15.536251>;<72.81688, 15.536251>];[<72.81688, 15.536251>;<73.567505, 15.536251>;<73.567505, 16.3325>;<72.81688, 16.3325>];[<72.06625, 16.3325>;<73.567505, 16.3325>;<73.567505, 17.925001>;<72.06625, 17.925001>];[<70.565, 17.925001>;<73.567505, 17.925001>;<73.567505, 21.11>;<70.565, 21.11>];[<73.567505, 14.740001>;<76.57, 14.740001>;<76.57, 17.925001>;<73.567505, 17.925001>];[<73.567505, 17.925001>;<76.57, 17.925001>;<76.57, 21.11>;<73.567505, 21.11>];[<64.56, 21.11>;<65.31062, 21.11>;<65.31062, 21.90625>;<64.56, 21.90625>];[<64.56, 21.90625>;<65.31062, 21.90625>;<65.31062, 22.7025>;<64.56, 22.7025>];
    [<65.31062, 21.11>;<66.06125, 21.11>;<66.06125, 21.90625>;<65.31062, 21.90625>];[<65.31062, 21.90625>;<66.06125, 21.90625>;<66.06125, 22.7025>;<65.31062, 22.7025>];[<64.56, 22.7025>;<66.06125, 22.7025>;<66.06125, 24.295>;<64.56, 24.295>];[<66.06125, 21.11>;<67.5625, 21.11>;<67.5625, 22.7025>;<66.06125, 22.7025>];[<66.06125, 22.7025>;<67.5625, 22.7025>;<67.5625, 24.295>;<66.06125, 24.295>];[<64.56, 24.295>;<67.5625, 24.295>;<67.5625, 27.48>;<64.56, 27.48>];[<67.5625, 21.11>;<70.565, 21.11>;<70.565, 24.295>;<67.5625, 24.295>];[<67.5625, 24.295>;<70.565, 24.295>;<70.565, 27.48>;<67.5625, 27.48>];[<64.56, 27.48>;<70.565, 27.48>;<70.565, 33.85>;<64.56, 33.85>];[<70.565, 21.11>;<76.57, 21.11>;<76.57, 27.48>;<70.565, 27.48>];
    [<70.565, 27.48>;<76.57, 27.48>;<76.57, 33.85>;<70.565, 33.85>]],
     [[<73.567505, 8.370001>;<76.57, 8.370001>;<76.57, 11.555>;<73.567505, 11.555>];[<73.567505, 11.555>;<75.068756, 11.555>;<75.068756, 13.147501>;<73.567505, 13.147501>];[<75.068756, 11.555>;<76.57, 11.555>;<76.57, 13.147501>;<75.068756, 13.147501>];[<70.565, 27.48>;<76.57, 27.48>;<76.57, 33.85>;<70.565, 33.85>]],
     [[<73.567505, 8.370001>;<76.57, 8.370001>;<76.57, 11.555>;<73.567505, 11.555>];[<73.567505, 11.555>;<75.068756, 11.555>;<75.068756, 13.147501>;<73.567505, 13.147501>];[<75.068756, 11.555>;<76.57, 11.555>;<76.57, 13.147501>;<75.068756, 13.147501>];[<70.565, 27.48>;<76.57, 27.48>;<76.57, 33.85>;<70.565, 33.85>]])
"""

match c with
| ReLit "("
    (AsPolygons(_, ReLit "," (AsPolygons(_, _)))) ->
        printfn "yay"
| _ ->
    printfn "boo"

match s, c with
| AsTestData((polys, _, shape), _), AsDebugData((candidates, qt, fa1, fa2), _) ->
    let polys =
        polys
        |> List.map (fun poly -> Chart.Line(poly, Color=System.Drawing.Color.Blue))
    let shape =
        Chart.Line(shape, Color=System.Drawing.Color.Red)
    let candidates =
        candidates
        |> List.map (fun poly -> Chart.Line(poly, Color=System.Drawing.Color.DarkGray))
    let bb =
        qt
        |> List.map (fun poly -> Chart.Line(poly, Color=System.Drawing.Color.Pink))
    Chart.Combine(shape :: polys @ candidates @ bb).ShowChart()
    |> ignore
| _ ->
    printfn "Failed to parse test data"